{"version":3,"sources":["src/jquery.i18n.js"],"names":["$","I18N","slice","Array","prototype","options","extend","defaults","parser","locale","messageStore","languages","localize","messageKey","localeParts","localePartIndex","fallbackIndex","tryingLocale","message","split","length","join","get","fallbackLocale","i18n","fallbacks","log","destroy","removeData","document","load","source","fallbackLocales","locIndex","sourceMap","pop","concat","parse","key","parameters","language","param1","data","undefined","call","arguments","fn","each","$this","lBracket","rBracket","type","indexOf","html","attr","text","find","getDefaultLocale","navigator","userLanguage","replace","str","match","index","parseInt","emitter","debug","window","console","apply","constructor","jQuery"],"mappings":"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","file":"jquery.i18n.f0dbebbf.map","sourceRoot":"..","sourcesContent":["/*!\n * jQuery Internationalization library\n *\n * Copyright (C) 2012 Santhosh Thottingal\n *\n * jquery.i18n is dual licensed GPLv2 or later and MIT. You don't have to do\n * anything special to choose one license or the other and you don't have to\n * notify anyone which license you are using. You are free to use\n * UniversalLanguageSelector in commercial projects as long as the copyright\n * header is left intact. See files GPL-LICENSE and MIT-LICENSE for details.\n *\n * @licence GNU General Public Licence 2.0 or later\n * @licence MIT License\n */\n\n( function ( $ ) {\n\t'use strict';\n\n\tvar I18N,\n\t\tslice = Array.prototype.slice;\n\t/**\n\t * @constructor\n\t * @param {Object} options\n\t */\n\tI18N = function ( options ) {\n\t\t// Load defaults\n\t\tthis.options = $.extend( {}, I18N.defaults, options );\n\n\t\tthis.parser = this.options.parser;\n\t\tthis.locale = this.options.locale;\n\t\tthis.messageStore = this.options.messageStore;\n\t\tthis.languages = {};\n\t};\n\n\tI18N.prototype = {\n\t\t/**\n\t\t * Localize a given messageKey to a locale.\n\t\t * @param {string} messageKey\n\t\t * @return {string} Localized message\n\t\t */\n\t\tlocalize: function ( messageKey ) {\n\t\t\tvar localeParts, localePartIndex, locale, fallbackIndex,\n\t\t\t\ttryingLocale, message;\n\n\t\t\tlocale = this.locale;\n\t\t\tfallbackIndex = 0;\n\n\t\t\twhile ( locale ) {\n\t\t\t\t// Iterate through locales starting at most-specific until\n\t\t\t\t// localization is found. As in fi-Latn-FI, fi-Latn and fi.\n\t\t\t\tlocaleParts = locale.split( '-' );\n\t\t\t\tlocalePartIndex = localeParts.length;\n\n\t\t\t\tdo {\n\t\t\t\t\ttryingLocale = localeParts.slice( 0, localePartIndex ).join( '-' );\n\t\t\t\t\tmessage = this.messageStore.get( tryingLocale, messageKey );\n\n\t\t\t\t\tif ( message ) {\n\t\t\t\t\t\treturn message;\n\t\t\t\t\t}\n\n\t\t\t\t\tlocalePartIndex--;\n\t\t\t\t} while ( localePartIndex );\n\n\t\t\t\tif ( locale === this.options.fallbackLocale ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tlocale = ( $.i18n.fallbacks[ this.locale ] &&\n\t\t\t\t\t\t$.i18n.fallbacks[ this.locale ][ fallbackIndex ] ) ||\n\t\t\t\t\t\tthis.options.fallbackLocale;\n\t\t\t\t$.i18n.log( 'Trying fallback locale for ' + this.locale + ': ' + locale + ' (' + messageKey + ')' );\n\n\t\t\t\tfallbackIndex++;\n\t\t\t}\n\n\t\t\t// key not found\n\t\t\treturn '';\n\t\t},\n\n\t\t/*\n\t\t * Destroy the i18n instance.\n\t\t */\n\t\tdestroy: function () {\n\t\t\t$.removeData( document, 'i18n' );\n\t\t},\n\n\t\t/**\n\t\t * General message loading API This can take a URL string for\n\t\t * the json formatted messages. Example:\n\t\t * <code>load('path/to/all_localizations.json');</code>\n\t\t *\n\t\t * To load a localization file for a locale:\n\t\t * <code>\n\t\t * load('path/to/de-messages.json', 'de' );\n\t\t * </code>\n\t\t *\n\t\t * To load a localization file from a directory:\n\t\t * <code>\n\t\t * load('path/to/i18n/directory', 'de' );\n\t\t * </code>\n\t\t * The above method has the advantage of fallback resolution.\n\t\t * ie, it will automatically load the fallback locales for de.\n\t\t * For most usecases, this is the recommended method.\n\t\t * It is optional to have trailing slash at end.\n\t\t *\n\t\t * A data object containing message key- message translation mappings\n\t\t * can also be passed. Example:\n\t\t * <code>\n\t\t * load( { 'hello' : 'Hello' }, optionalLocale );\n\t\t * </code>\n\t\t *\n\t\t * A source map containing key-value pair of languagename and locations\n\t\t * can also be passed. Example:\n\t\t * <code>\n\t\t * load( {\n\t\t * bn: 'i18n/bn.json',\n\t\t * he: 'i18n/he.json',\n\t\t * en: 'i18n/en.json'\n\t\t * } )\n\t\t * </code>\n\t\t *\n\t\t * If the data argument is null/undefined/false,\n\t\t * all cached messages for the i18n instance will get reset.\n\t\t *\n\t\t * @param {string|Object} source\n\t\t * @param {string} locale Language tag\n\t\t * @return {jQuery.Promise}\n\t\t */\n\t\tload: function ( source, locale ) {\n\t\t\tvar fallbackLocales, locIndex, fallbackLocale, sourceMap = {};\n\t\t\tif ( !source && !locale ) {\n\t\t\t\tsource = 'i18n/' + $.i18n().locale + '.json';\n\t\t\t\tlocale = $.i18n().locale;\n\t\t\t}\n\t\t\tif ( typeof source === 'string' &&\n\t\t\t\t// source extension should be json, but can have query params after that.\n\t\t\t\tsource.split( '?' )[ 0 ].split( '.' ).pop() !== 'json'\n\t\t\t) {\n\t\t\t\t// Load specified locale then check for fallbacks when directory is\n\t\t\t\t// specified in load()\n\t\t\t\tsourceMap[ locale ] = source + '/' + locale + '.json';\n\t\t\t\tfallbackLocales = ( $.i18n.fallbacks[ locale ] || [] )\n\t\t\t\t\t.concat( this.options.fallbackLocale );\n\t\t\t\tfor ( locIndex = 0; locIndex < fallbackLocales.length; locIndex++ ) {\n\t\t\t\t\tfallbackLocale = fallbackLocales[ locIndex ];\n\t\t\t\t\tsourceMap[ fallbackLocale ] = source + '/' + fallbackLocale + '.json';\n\t\t\t\t}\n\t\t\t\treturn this.load( sourceMap );\n\t\t\t} else {\n\t\t\t\treturn this.messageStore.load( source, locale );\n\t\t\t}\n\n\t\t},\n\n\t\t/**\n\t\t * Does parameter and magic word substitution.\n\t\t *\n\t\t * @param {string} key Message key\n\t\t * @param {Array} parameters Message parameters\n\t\t * @return {string}\n\t\t */\n\t\tparse: function ( key, parameters ) {\n\t\t\tvar message = this.localize( key );\n\t\t\t// FIXME: This changes the state of the I18N object,\n\t\t\t// should probably not change the 'this.parser' but just\n\t\t\t// pass it to the parser.\n\t\t\tthis.parser.language = $.i18n.languages[ $.i18n().locale ] || $.i18n.languages[ 'default' ];\n\t\t\tif ( message === '' ) {\n\t\t\t\tmessage = key;\n\t\t\t}\n\t\t\treturn this.parser.parse( message, parameters );\n\t\t}\n\t};\n\n\t/**\n\t * Process a message from the $.I18N instance\n\t * for the current document, stored in jQuery.data(document).\n\t *\n\t * @param {string} key Key of the message.\n\t * @param {string} param1 [param...] Variadic list of parameters for {key}.\n\t * @return {string|$.I18N} Parsed message, or if no key was given\n\t * the instance of $.I18N is returned.\n\t */\n\t$.i18n = function ( key, param1 ) {\n\t\tvar parameters,\n\t\t\ti18n = $.data( document, 'i18n' ),\n\t\t\toptions = typeof key === 'object' && key;\n\n\t\t// If the locale option for this call is different then the setup so far,\n\t\t// update it automatically. This doesn't just change the context for this\n\t\t// call but for all future call as well.\n\t\t// If there is no i18n setup yet, don't do this. It will be taken care of\n\t\t// by the `new I18N` construction below.\n\t\t// NOTE: It should only change language for this one call.\n\t\t// Then cache instances of I18N somewhere.\n\t\tif ( options && options.locale && i18n && i18n.locale !== options.locale ) {\n\t\t\ti18n.locale = options.locale;\n\t\t}\n\n\t\tif ( !i18n ) {\n\t\t\ti18n = new I18N( options );\n\t\t\t$.data( document, 'i18n', i18n );\n\t\t}\n\n\t\tif ( typeof key === 'string' ) {\n\t\t\tif ( param1 !== undefined ) {\n\t\t\t\tparameters = slice.call( arguments, 1 );\n\t\t\t} else {\n\t\t\t\tparameters = [];\n\t\t\t}\n\n\t\t\treturn i18n.parse( key, parameters );\n\t\t} else {\n\t\t\t// FIXME: remove this feature/bug.\n\t\t\treturn i18n;\n\t\t}\n\t};\n\n\t$.fn.i18n = function () {\n\t\tvar i18n = $.data( document, 'i18n' );\n\n\t\tif ( !i18n ) {\n\t\t\ti18n = new I18N();\n\t\t\t$.data( document, 'i18n', i18n );\n\t\t}\n\n\t\treturn this.each( function () {\n\t\t\tvar $this = $( this ),\n\t\t\t\tmessageKey = $this.data( 'i18n' ),\n\t\t\t\tlBracket, rBracket, type, key;\n\n\t\t\tif ( messageKey ) {\n\t\t\t\tlBracket = messageKey.indexOf( '[' );\n\t\t\t\trBracket = messageKey.indexOf( ']' );\n\t\t\t\tif ( lBracket !== -1 && rBracket !== -1 && lBracket < rBracket ) {\n\t\t\t\t\ttype = messageKey.slice( lBracket + 1, rBracket );\n\t\t\t\t\tkey = messageKey.slice( rBracket + 1 );\n\t\t\t\t\tif ( type === 'html' ) {\n\t\t\t\t\t\t$this.html( i18n.parse( key ) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.attr( type, i18n.parse( key ) );\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$this.text( i18n.parse( messageKey ) );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$this.find( '[data-i18n]' ).i18n();\n\t\t\t}\n\t\t} );\n\t};\n\n\tfunction getDefaultLocale() {\n\t\tvar locale = $( 'html' ).attr( 'lang' );\n\t\tif ( !locale ) {\n\t\t\tlocale = navigator.language || navigator.userLanguage || '';\n\t\t}\n\t\treturn locale;\n\t}\n\n\t$.i18n.languages = {};\n\t$.i18n.messageStore = $.i18n.messageStore || {};\n\t$.i18n.parser = {\n\t\t// The default parser only handles variable substitution\n\t\tparse: function ( message, parameters ) {\n\t\t\treturn message.replace( /\\$(\\d+)/g, function ( str, match ) {\n\t\t\t\tvar index = parseInt( match, 10 ) - 1;\n\t\t\t\treturn parameters[ index ] !== undefined ? parameters[ index ] : '$' + match;\n\t\t\t} );\n\t\t},\n\t\temitter: {}\n\t};\n\t$.i18n.fallbacks = {};\n\t$.i18n.debug = false;\n\t$.i18n.log = function ( /* arguments */ ) {\n\t\tif ( window.console && $.i18n.debug ) {\n\t\t\twindow.console.log.apply( window.console, arguments );\n\t\t}\n\t};\n\t/* Static members */\n\tI18N.defaults = {\n\t\tlocale: getDefaultLocale(),\n\t\tfallbackLocale: 'en',\n\t\tparser: $.i18n.parser,\n\t\tmessageStore: $.i18n.messageStore\n\t};\n\n\t// Expose constructor\n\t$.i18n.constructor = I18N;\n}( jQuery ) );\n"]}